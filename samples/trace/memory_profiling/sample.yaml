sample:
  name: memory_profiling
common:
  tags: profiling
tests:
  sample.trace.memory_profiling:
    tags: profiling
    harness: console
    harness_config:
      type: one_line
      regex:
        - "Counter: 5"
        - "zpl_memory_event stack \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event heap \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event k_heap \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event mem_slab \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "Counter: 4"
        - "zpl_memory_event stack \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event heap \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event k_heap \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event mem_slab \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "Counter: 1"
        - "zpl_memory_event stack \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event heap \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event k_heap \\(0x[0-9a-f]+\\) \\d+B \\d+B"
        - "zpl_memory_event mem_slab \\(0x[0-9a-f]+\\) \\d+B \\d+B"
    extra_configs:
      - CONFIG_TRACING_BUFFER_SIZE=4096
  sample.trace.memory_profiling.plaintext.robot:
    tags: profiling
    harness: robot
    harness_config:
      robot_testsuite: memory_profiling.robot
    extra_configs:
      - CONFIG_TRACING_BUFFER_SIZE=4096
  sample.trace.memory_profiling.ctf.robot:
    tags: profiling
    harness: robot
    harness_config:
      robot_testsuite: memory_profiling_ctf.robot
    extra_configs:
      - CONFIG_TRACING_BUFFER_SIZE=4096
      - CONFIG_ZPL_TRACE_FORMAT_CTF=y
  sample.trace.memory_profiling.uart_conf.robot:
    tags: profiling
    harness: robot
    harness_config:
      robot_testsuite: memory_profiling_uart_conf.robot
    extra_configs:
      - CONFIG_ZPL_MEMORY_USAGE_TRACE=n
      - CONFIG_ZPL_RUNTIME_CONFIG_UART=y
      - CONFIG_TRACING_SYSCALL=n
      - CONFIG_TRACING_THREAD=n
      - CONFIG_TRACING_WORK=n
      - CONFIG_TRACING_ISR=n
      - CONFIG_TRACING_SEMAPHORE=n
      - CONFIG_TRACING_MUTEX=n
      - CONFIG_TRACING_CONDVAR=n
      - CONFIG_TRACING_QUEUE=n
      - CONFIG_TRACING_FIFO=n
      - CONFIG_TRACING_LIFO=n
      - CONFIG_TRACING_STACK=n
      - CONFIG_TRACING_MESSAGE_QUEUE=n
      - CONFIG_TRACING_MAILBOX=n
      - CONFIG_TRACING_PIPE=n
      - CONFIG_TRACING_HEAP=n
      - CONFIG_TRACING_MEMORY_SLAB=n
      - CONFIG_TRACING_TIMER=n
      - CONFIG_TRACING_EVENT=n
      - CONFIG_TRACING_POLLING=n
      - CONFIG_TRACING_PM=n
      - CONFIG_TRACING_NETWORKING=n
      - CONFIG_TRACING_NET_SOCKETS=n
      - CONFIG_TRACING_NET_CORE=n
      - CONFIG_TRACING_GPIO=n
      - CONFIG_TRACING_IDLE=n
  sample.trace.memory_profiling.none_conf.robot:
    tags: profiling
    harness: robot
    harness_config:
      robot_testsuite: memory_profiling_none_conf.robot
    extra_configs:
      - CONFIG_ZPL_MEMORY_USAGE_TRACE=n
      - CONFIG_ZPL_RUNTIME_CONFIG_NONE=y
